app.pages.index={content:null,init:function(a){var b=this;app.modules.api.info(function(c,d){if(d){var e=Object.keys(d.stages).reduce(function(a,b){return a+parseInt(d.stages[b].tokensSold)},0),f=Object.keys(d.stages).reduce(function(a,b){return a+parseInt(d.stages[b].totalInvestors)},0),g={bitcoin:d.stages[0].received.bitcoin+d.stages[1].received.bitcoin,ethereum:d.stages[0].received.ethereum+d.stages[1].received.ethereum,litecoin:d.stages[0].received.litecoin+d.stages[1].received.litecoin,zcash:d.stages[0].received.zcash+d.stages[1].received.zcash,bitshares:d.stages[0].received.bitshares+d.stages[1].received.bitshares||0},h={bitcoin:d.stages[0].received_fiat.bitcoin+d.stages[1].received_fiat.bitcoin,ethereum:d.stages[0].received_fiat.ethereum+d.stages[1].received_fiat.ethereum,litecoin:d.stages[0].received_fiat.litecoin+d.stages[1].received_fiat.litecoin,zcash:d.stages[0].received_fiat.zcash+d.stages[1].received_fiat.zcash,bitshares:d.stages[0].received_fiat.bitshares+d.stages[1].received_fiat.bitshares},i=Handlebars.templates.index({profile:{name:app.modules.user.getName(),email:app.modules.user.getEmail(),investments:app.modules.user.getInvestments(),bonuses:app.modules.user.getBonuses()},payment:{wallets:app.modules.user.getWallets(),prices:app.modules.helper.getArrayRounding(d.price,2)},investments:{discount:app.modules.user.getFormatDiscount(),max_atb:MAX_ATB.formatMoney(0,"."," "),tokensSold:e.formatMoney(0,"."," "),receiveds:app.modules.helper.getArrayRounding(g,2),receivedsFiat:app.modules.helper.getArrayFormatMoney(h),totalInvestors:f,percent:e>MAX_ATB?100:e/(MAX_ATB/100)},bountyHunting:{social_network:SOCIAL_NETWORK,totalTokens:app.modules.user.info.otherBalance&&app.modules.user.info.otherBalance.totalBountyTokens?app.modules.user.info.otherBalance.totalBountyTokens:0,twitter:{countTweets:app.modules.user.info.twitter&&app.modules.user.info.twitter.countTweets?app.modules.user.info.twitter.countTweets:0},facebook:{countReview:app.modules.user.info.facebook&&app.modules.user.info.facebook.countReview?app.modules.user.info.facebook.countReview:0,task:config.socialNetwork.facebook.task}},debug:DEBUG});b.content=$(".content"),b.content.find(".container").html(i),b.progressTooltip(),b.generateQrCode(),b.initEvents(),b.initCircleProgressDash(),app.modules.global.initClipboard(),a&&"function"==typeof a&&a()}})},initEvents:function(){var a=this;a.content.find(".tab__link").on("click",this.toggleTab),a.content.find(".btn-copy").on("click",function(){app.modules.analytics.gaCounter("send","event","Copy","click",$(this).attr("data-type")+"-copy"),$(this).addClass("copied")}),a.content.find(".bounty__item>a").on("click",function(){app.pages.index.getTokenSocialNetWork($(this).attr("data-type"),$(this).attr("data-task"))}),a.content.find(".checkbox_confirm_bts").on("change",function(){$(this).closest(".form__row").removeClass("error")}),a.content.find(".btn_bts_success").on("click",function(){a.content.find(".checkbox_confirm_bts").is(":checked")?(a.content.find("#bts .bts__warning").hide(),a.content.find("#bts .bts__qr").show(),a.content.find(".checkbox_confirm_bts").prop("checked",!1)):a.content.find(".checkbox_confirm_bts").closest(".form__row").addClass("error")})},toggleTab:function(a){a.preventDefault(),$(this).closest(".tab__wrap").find(".tab__link").removeClass("active"),$(this).addClass("active");var b=$(this).attr("href");$(this).closest(".tab__wrap").find(".tab__pane").not(b).removeClass("active"),$(b).addClass("active"),app.modules.analytics.yaCounter($(this).attr("data-type")+"-after-registration"),app.modules.analytics.gaCounter("send","event","Coins","click",$(this).attr("data-type")),app.pages.index.content.find(".btn-copy").removeClass("copied"),app.pages.index.content.find("#bts .bts__warning").show(),app.pages.index.content.find("#bts .bts__qr").hide()},progressTooltip:function(){var a=$(".progress__bar").width();$(".progress__tooltip").css("left",a)},generateQrCode:function(){var a=app.modules.user.getWallets();$.each(a,function(a,b){$("#qr_code_"+a).length&&app.modules.global.initQrCode("qr_code_"+a,b.address,{width:280,height:280,colorDark:"#65c3b6",colorLight:"#ffffff"})})},getTokenSocialNetWork:function(a,b){switch(a){case SOCIAL_NETWORK.twitter:app.modules.social_network.twitter.winId=app.modules.global.windowOpen(app.modules.social_network.twitter.url,""),app.modules.user.info.twitter&&app.modules.user.info.twitter.id||app.modules.social_network.twitter.startInterval();break;case SOCIAL_NETWORK.facebook:switch(b){case config.socialNetwork.facebook.task.review:app.modules.social_network.facebook.getLoginStatus(function(a){window.location.href=a})}}},initCircleProgressDash:function(){if(!app.modules.user.discount)return!1;$.circleProgress.defaults.arcCoef=1,$.circleProgress.defaults.startAngle=.5*Math.PI,$.circleProgress.defaults.dashSize=Math.PI/100,$.circleProgress.defaults.size=180,$.circleProgress.defaults.thickness=10,$.circleProgress.defaults.fill={color:"#39b5b5"},$.circleProgress.defaults.emptyFill="#dcf5f6",$.circleProgress.defaults.drawArc=function(a){var b=this.ctx,c=this.radius,d=this.getThickness(),e=this.arcCoef,f=this.startAngle+(1-e)*Math.PI;a=Math.max(0,Math.min(1,a)),b.save(),b.beginPath(),this.reverse?b.arc(c,c,c-d/2,f+2*e*Math.PI,f+2*e*(1-a)*Math.PI,f):b.arc(c,c,c-d/2,f,f+2*e*Math.PI*a),b.lineWidth=d,b.lineCap=this.lineCap,b.strokeStyle=this.arcFill,b.stroke(),b.restore(),this.addDashes()},$.circleProgress.defaults.addDashes=function(){var a=this.ctx,b=this.radius,c=this.getThickness(),d=this.dashSize,e=this.arcCoef,f=this.startAngle+(1-e)*Math.PI,g=this.dashesAmount;a.save(),a.lineCap="butt",a.lineWidth=c,a.strokeStyle="#fff",a.globalCompositeOperation="destination-out";for(var h=0;h<g;h++){a.beginPath();var i=f+2*e*(1-(h+1)/g)*Math.PI;a.arc(b,b,b-c/2,i-d/2,i+d/2),a.stroke()}a.restore()},$.circleProgress.defaults.drawEmptyArc=function(a){var b=this.ctx,c=this.radius,d=this.getThickness(),e=this.arcCoef,f=this.startAngle+(1-e)*Math.PI;(a=Math.max(0,Math.min(1,a)))<1&&(b.save(),b.beginPath(),a<=0?b.arc(c,c,c-d/2,f,f+2*e*Math.PI):this.reverse?b.arc(c,c,c-d/2,f,f+2*e*(1-a)*Math.PI):b.arc(c,c,c-d/2,f+2*e*Math.PI*a,f+2*e*Math.PI),b.lineWidth=d,b.lineCap=this.lineCap,b.strokeStyle=this.emptyFill,b.stroke(),b.restore())},$.each(app.modules.user.discount,function(a){if(app.modules.user.discount[a+1]){var b=moment(app.modules.user.discount[a][1]),c=moment(app.modules.user.discount[a+1][1]),d=moment().zone(0).format(),e=Math.abs(b.diff(c,"days")),f=moment(d).diff(b,"days");f<0&&(f=0),f>e&&(f=e),app.pages.index.circleProgressDash(app.pages.index.content.find("#circle-"+(a+1)),e,f)}})},circleProgressDash:function(a,b,c){var d="";c>0?d="active":c>=b&&(d="finished"),$(a).circleProgress({dashesAmount:b,value:1/b*c}).closest(".circleProgress__item").addClass(d)}},app.pages.membership={content:null,init:function(a){var b=this;app.modules.user.isVip()?app.modules.api.referrals(function(c,d){d&&($.each(d,function(a,b){d[a].bonus=b.bonus>0?parseFloat(b.bonus).toFixed(2):b.bonus,d[a].tokens=b.tokens>0?parseFloat(b.tokens).toFixed(2):b.tokens}),b.getHtml(d,a))}):this.getHtml({},a)},getHtml:function(a,b){var c={ref_link:config.languages[app.modules.global.currentLang].url_landing+"?ref="+app.modules.user.info.referrer.key,enabled_download_csv:app.modules.user.isSpecial(),download_csv_link:config.api+config.request.download_referrals_csv};0!==Object.keys(a).length&&(c.referrals=a);var d=Handlebars.templates.membership(c);this.content=$(".content"),this.content.find(".container").html(d),this.initEvents(),app.modules.global.initClipboard(),b&&"function"==typeof b&&b()},initEvents:function(){this.content.find(".acc__itemTop").on("click",this.accToggle),this.content.find(".btn-copy").on("click",function(){$(this).addClass("copied")})},accToggle:function(){$(this).toggleClass("open").nextAll(".acc__subitem").stop().slideToggle()}},app.pages.authentication={content:null,init:function(a){var b=this,c=Handlebars.templates.authentication();b.content=$(".content"),b.content.find(".container").html(c),app.modules.user.isEnabledTFA()?(b.content.find("#tfa_block").html(Handlebars.templates.tfa_disable({})),b.initEvents(),a&&"function"==typeof a&&a()):app.modules.api.generateSecret(app.modules.user.getEmail(),function(c,d){d&&(b.content.find("#tfa_block").html(Handlebars.templates.tfa_enable({secret:d.secret,tfa:app.modules.user.isEnabledTFA()})),app.pages.authentication.generateQrCode("qr_code_tfa",decodeURIComponent(d.uri)),b.initEvents(),a&&"function"==typeof a&&a())})},initEvents:function(){this.content.find("input[name=change_i_have_key]").on("change",function(){$(".btn_enabled_tfa").toggleClass("disabled")}),this.content.find(".btn_enabled_tfa").on("click",function(){$(this).hasClass("disabled")||app.pages.authentication.enableTFA()}),this.content.find(".btn_disable_tfa").on("click",function(){app.pages.authentication.disableTFA()}),this.content.find(".btn_change_password").on("click",function(){app.pages.authentication.changePassword()})},enableTFA:function(){var a=this;$(".form__row",this.content).removeClass("error");var b=!0;if($("input[name=tfa_code]",this.content).val()||($("input[name=tfa_code]",this.content).closest(".form__row").addClass("error"),b=!1),$("input[name=password]",this.content).val()||($("input[name=password]",this.content).closest(".form__row").addClass("error"),b=!1),b){var c=$("input[name=tfa_secret]",this.content).val(),d=$("input[name=password]",this.content).val(),e=$("input[name=tfa_code]",this.content).val();app.modules.api.enableTFA(d,c,e,function(b,c){c&&app.modules.user.updateInfo(function(){app.pages.authentication.init()}),b&&(b=JSON.parse(b),b.password&&$("input[name=password]",a.content).closest(".form__row").addClass("error"),b.token&&$("input[name=tfa_code]",a.content).closest(".form__row").addClass("error"))})}},disableTFA:function(){var a=this;$(".form__row",this.content).removeClass("error");var b=!0;if($("input[name=password]",this.content).val()||($("input[name=password]",this.content).closest(".form__row").addClass("error"),b=!1),$("input[name=tfa_code]",this.content).val()||($("input[name=tfa_code]",this.content).closest(".form__row").addClass("error"),b=!1),b){var c=$("input[name=password]",this.content).val(),d=$("input[name=tfa_code]",this.content).val();app.modules.api.disableTFA(c,d,function(b,c){c&&app.modules.user.updateInfo(function(){app.pages.authentication.init()}),b&&(b=JSON.parse(b),b.password&&$("input[name=password]",a.content).closest(".form__row").addClass("error"),b.token&&$("input[name=tfa_code]",a.content).closest(".form__row").addClass("error"))})}},changePassword:function(){var a=this;$(".btn_change_password",this.content).removeClass("changed"),$(".form__row",this.content).removeClass("error");var b=!0;if($("input[name=old_password]",this.content).val()||($("input[name=old_password]",this.content).closest(".form__row").addClass("error"),b=!1),$("input[name=new_password]",this.content).val()||($("input[name=new_password]",this.content).closest(".form__row").addClass("error"),b=!1),$("input[name=new_repeat_password]",this.content).val()&&$("input[name=new_repeat_password]",this.content).val()==$("input[name=new_password]",this.content).val()||($("input[name=new_repeat_password]",this.content).closest(".form__row").addClass("error"),b=!1),b){var c=$("input[name=old_password]",this.content).val(),d=$("input[name=new_password]",this.content).val();app.modules.api.changePassword(c,d,function(b,c){b&&(b=JSON.parse(b),b.newPassword&&($("input[name=new_password]",a.content).closest(".form__row").addClass("error"),$("input[name=new_repeat_password]",a.content).closest(".form__row").addClass("error")),b.password&&$("input[name=old_password]",a.content).closest(".form__row").addClass("error")),c&&($(".btn_change_password",a.content).addClass("changed"),$("input[name=old_password]",a.content).val(""),$("input[name=new_password]",a.content).val(""),$("input[name=new_repeat_password]",a.content).val(""))})}},generateQrCode:function(a,b){app.modules.global.initQrCode(a,b,{width:200,height:200,colorDark:"#65c3b6",colorLight:"#ffffff",CorrectLevel:QRCode.CorrectLevel.L})}};