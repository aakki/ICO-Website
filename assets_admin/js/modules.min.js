var app={modules:{},pages:{}};app.modules.api={isAuth:function(a){this._sendRequest("get",config.request.is_auth,{},a)},me:function(a){this._sendRequest("get",config.request.me,{},a)},info:function(a){this._sendRequest("get",config.request.info,{},a)},discount:function(a){this._sendRequest("get",config.request.discount,{},a)},referrals:function(a){this._sendRequest("get",config.request.referrals,{},a)},logout:function(a){this._sendRequest("get",config.request.logout,{},a)},changePassword:function(a,b,c){this._sendRequest("post",config.request.change_password,{password:a,newPassword:b},c)},generateSecret:function(a,b){this._sendRequest("get",config.request.generate_secret+"/"+a,{},b)},enableTFA:function(a,b,c,d){this._sendRequest("post",config.request.tfa_enable,{password:a,secret:b,token:c},d)},disableTFA:function(a,b,c){this._sendRequest("post",config.request.tfa_disable,{password:a,token:b},c)},facebook_auth:function(a,b){this._sendRequest("post",config.request.facebook_auth,{access_token:a},b)},facebookGetAuth:function(a,b){this._sendRequest("get",config.request.facebook_get_auth,{redirect:a},b)},twitterGetAuth:function(a,b){this._sendRequest("get",config.request.twitter_get_auth,{redirect:a},b)},lotteryNotified:function(a){this._sendRequest("get",config.request.lottery_notified,{},a)},_sendRequest:function(a,b,c,d){$.ajax(config.api+b,{type:a,data:c,xhrFields:{withCredentials:!0},success:function(a){d(null,a)},error:function(a){console.error("Error in API Wrapper: "+a.responseText),d(a.responseText)}})}},app.modules.global={currentPage:null,currentLang:null,init:function(){this.initHeader(),this.initEvents(),app.modules.social_network.init()},initHeader:function(){var a=Handlebars.templates.header({pages:PAGES,email:app.modules.user.getEmail(),urlLanding:config.languages[this.currentLang].url_landing,currentLang:this.currentLang,languages:config.languages,debug:DEBUG});$("header").html(a),this.updateTotalReceivedTokens()},initVerifyAccount:function(){var a=Handlebars.templates.verify_account({});$(".wrapper").addClass("center").find(".content").addClass("center").find(".container").html(a)},initEvents:function(){$(document).on("click",function(a){if($(".lang__wrap").hasClass("open")){if($(a.target).closest(".lang__current, .lang__wrap").length)return;$(".lang__wrap").removeClass("open")}}),$(".btn-menu_js").on("click",this.toggleMobileMenu),$(".lang__current").on("click",function(){$(this).closest(".lang__wrap").toggleClass("open")}),$(".change_page").on("click",function(a){$(this).attr("data-page")&&app.modules.global.changePage($(this).attr("data-page"))}),$(".btn_logout").on("click",function(a){app.modules.api.logout(function(){window.location=config.languages[app.modules.global.currentLang].url_landing})})},changePage:function(a,b){function c(){clearTimeout(d),app.modules.global.loadingPage.remove(),app.modules.user.updateInfo(function(){app.modules.global.updateTotalReceivedTokens()}),b&&"function"==typeof b&&b()}this.closeMobileMenu();var d=setTimeout(function(){app.modules.global.loadingPage.add()},1e3);if(a)switch(this.currentPage=a,this.currentPage){case PAGES.index:app.pages.index.init(c());break;case PAGES.membership:app.pages.membership.init(c());break;case PAGES.authentication:app.pages.authentication.init(c())}this.activePage(a)},activePage:function(a){$(".mainNav__wrap a").removeClass("active"),$(".mainNav__wrap a[data-page="+a+"]").addClass("active")},toggleMobileMenu:function(a){a.preventDefault(),$(this).toggleClass("is-active"),$(this).next(".mainNav__wrap").toggleClass("open"),$(this).closest(".header").find(".header__logo").toggleClass("visible")},closeMobileMenu:function(){$(".btn-menu_js").removeClass("is-active").next(".mainNav__wrap").removeClass("open").closest(".header").find(".header__logo").removeClass("visible")},windowOpen:function(a,b){return window.open(a,b,"height=500, width=700, top="+($(window).height()/2-275)+", left="+($(window).width()/2-225)+", toolbar=0, location=0, menubar=0, directories=0, scrollbars=0")},loadingGlobal:{hide:function(){$(".wrapper").removeClass("global-loader")}},loadingPage:{add:function(){$(".wrapper").addClass("loader")},remove:function(){$(".wrapper").removeClass("loader")}},updateTotalReceivedTokens:function(){$(".profile__info .value").html(app.modules.user.getTotalReceivedTokens()+" ATB")},initClipboard:function(){$(".btn-copy").length&&new Clipboard(".btn-copy")},initQrCode:function(a,b,c){new QRCode(a,{text:b,width:c.width,height:c.height,colorDark:c.colorDark,colorLight:c.colorLight,correctLevel:c.CorrectLevel?c.CorrectLevel:QRCode.CorrectLevel.H})}},$(window).on({resize:function(){switch(app.modules.global.currentPage){case PAGES.index:app.pages.index.progressTooltip()}},scroll:function(){}}),app.modules.helper={getArrayFormatMoney:function(a){return $.each(a,function(b,c){a[b]=parseFloat(c).formatMoney(2,"."," ")}),a},getArrayRounding:function(a,b){return $.each(a,function(c,d){a[c]=parseFloat(d).crop(b)}),a},getDayDelta:function(a,b){var c,a=new Date(a[0],a[1]-1,a[2]),d=new Date(b[0],b[1]-1,b[2]);return d.setHours(0),d.setMinutes(0),d.setSeconds(0),d.setMilliseconds(0),d.setHours(0),d.setMinutes(0),c=a-d,Math.round(c/1e3/60/60/24)}},Number.prototype.formatMoney=function(a,b,c){var d=this,a=isNaN(a=Math.abs(a))?2:a,b=void 0==b?".":b,c=void 0==c?",":c,e=d<0?"-":"",f=String(parseInt(d=Math.abs(Number(d)||0).toFixed(a))),g=(g=f.length)>3?g%3:0;return e+(g?f.substr(0,g)+c:"")+f.substr(g).replace(/(\d{3})(?=\d)/g,"$1"+c)+(a?b+Math.abs(d-f).toFixed(a).slice(2):"")},Number.prototype.crop=function(a){var b=this+"",c=b.split(".");return c[1]=c[1]||"",parseFloat(c[0]+"."+c[1].substring(0,a))},app.modules.user={init:function(a,b){this.info=a,app.modules.api.discount(function(a,c){app.modules.user.discount=c,b&&"function"==typeof b&&b()})},updateInfo:function(a){app.modules.api.me(function(b,c){app.modules.user.info=c,a&&"function"==typeof a&&a()})},getTotalReceivedTokens:function(){var a=0;return this.info&&(a=parseFloat(app.modules.user.info.balance).formatMoney(2,"."," ")),a},getEmail:function(){return this.info?this.info.email:""},getName:function(){return this.info?this.info.name:""},getWallets:function(){return this.info?this.info.wallets:{}},isVip:function(){return!!this.info&&this.info.referrer.vip},isSpecial:function(){return!(!this.info||!this.info.referrer.special)&&this.info.referrer.special},isConfirmedEmail:function(){return!!this.info&&this.info.confirmedEmail},isEnabledTFA:function(){return!!this.info&&this.info.tfa},checkIsWinnerLottery:function(){return this.info&&this.info.lottery&&!this.info.lottery.notified&&this.info.lottery.winner&&app.modules.user.info.otherBalance&&parseInt(app.modules.user.info.otherBalance.totalLotteryTokens)&&app.modules.popup.lotteryWin(app.modules.user.info.otherBalance.totalLotteryTokens),!1},getInvestments:function(){return this.info&&this.info.separatedBalance?parseFloat(this.info.separatedBalance.investments):0},getBonuses:function(){return this.info&&this.info.separatedBalance?parseFloat(this.info.separatedBalance.bonuses):0},getPercentByDiscount:function(a){return this.discount&&this.discount[a]?this.discount&&this.discount[a][0]:0},getFormatDiscount:function(){var a=[];return this.discount&&$.each(this.discount,function(b,c){if(c[0]&&app.modules.user.discount[b+1]){var d={percent:c[0],date:moment(c[1]).format("D MMMM")+" - "+moment(app.modules.user.discount[b+1][1]).subtract(1,"days").format("D MMMM")};a.push(d)}}),a}},app.modules.popup={classPopupBox:".popup_box",lotteryWin:function(a,b){$("#modalWin").modal("hide");var c=$(Handlebars.templates.lottery_win({coins_win:a}));$(this.classPopupBox).html(c).promise().done(function(){$("#modalWin").modal("show")}),$("#modalWin").on("hide.bs.modal",function(a){app.modules.api.lotteryNotified(function(a,b){})})}},app.modules.analytics={yaCounter:function(a){"undefined"!=typeof yaCounter45054713&&yaCounter45054713.reachGoal(a)},gaCounter:function(a,b,c,d,e){"function"==typeof ga&&ga(a,b,c,d,e)}},app.modules.social_network={init:function(){app.modules.social_network.twitter.connect&&(window.location=app.modules.social_network.twitter.urlPost()),app.modules.social_network.twitter.init(function(){})},facebook:{getLoginStatus:function(a){app.modules.api.facebookGetAuth(config.languages[app.modules.global.currentLang].url_dashboard,function(b,c){return a(c)})}},twitter:{connect:!1,url:"",winId:null,intervalClosedWindow:null,init:function(a){this.getLoginStatus(a)},getLoginStatus:function(a){if(app.modules.user.info.twitter&&app.modules.user.info.twitter.id)return app.modules.social_network.twitter.url=app.modules.social_network.twitter.urlPost(),a();app.modules.api.twitterGetAuth(config.languages[app.modules.global.currentLang].url_dashboard,function(b,c){return app.modules.social_network.twitter.url=c,a()})},urlPost:function(){return"https://twitter.com/intent/tweet?text="+encodeURIComponent(TWITTER_POST)},startInterval:function(){app.modules.social_network.twitter.clearInterval(),this.intervalClosedWindow=setInterval(function(){app.modules.social_network.twitter.winId.closed&&app.modules.social_network.twitter.clearInterval()},1e3)},clearInterval:function(){app.modules.social_network.twitter.intervalClosedWindow&&(clearInterval(app.modules.social_network.twitter.intervalClosedWindow),app.modules.user.updateInfo(function(){app.modules.social_network.twitter.getLoginStatus(function(){})}))}}};